/********************************************************************************************************************************************
*                                                                                                                                           *
*              ---------------------------------以下是模块的修改记录区-----------------------------------------                             *
*                                                                                                                                           *
********************************************************************************************************************************************/
/**********************************************
 * 内  容：
 * 日  期：2013-10-11
 * 作  者：YJX
 * 版本号：V1.0（初版）
 ***********************************************
 * 修改内容：
 *         【1】、修改设置函数的第二个输入参数，如果为0，则表示关闭该定时器
 * 修改日期：2014-01-20
 * 修改作者：YJX
 * 版 本 号：V1.1

 * 修改内容：
 *         【1】、更改为FUN级模块
 * 修改日期：2021-10-18
 * 修改作者：YJX
 * 版 本 号：V1.2
 ***********************************************
*/

#include "ProHeadFile.h"
/********************************************************************************************************************************************
*                                                                                                                                           *
*                ---------------------------------以下是模块的使用说明区-----------------------------------------                           *
*                                                                                                                                           *
********************************************************************************************************************************************/
/*                                           模块使用说明：
【1】、该FUN级定时器只提供一个“外壳”模块，需要几个定时时间就可以利用头文件中的TIMERTYPE变量类型定义几个变量，变量引用同一个“外壳”模块进行定时操作
【2】、使用条件，需要一个定时器模块，该定时器模块的周期中断来调用FUN_Timer_INT函数做为基时判断。
【3】、定时时间以计数值倍的定时器中断时间来定时
       即，如果设定的计数值为10，驱动定时器的中断时间为1ms，则定时时间为1*10ms = 10ms
           如果设定的计数值为10，驱动定时器的中断时间为10ms,则定时时间为10*10ms = 100ms
           可以通过调用FUN_Timer_SetDelay函数来设定计数值
           依此类推
【4】、定时器误差：
       受调用FUN_Timer_INT函数的定时器决定。
       如果驱动定时器的中断每 1ms调用一次FUN_Timer_INT，则误差为士1ms
       如果驱动定时器的中断每10ms调用一次FUN_Timer_INT，则误差为士10ms
       

 *
 * 模块使用示例
 * 在名为YYT项目模块中要求一上电进行200ms的延时操作，（设置项目的驱动定时器的中断时间为10ms）操作如下 ：
 * （1）、在YYT模块中使用TIMERTYPE变量类型定义一个（如变量名为：Delay1）的全局变量
 * （2）、在项目系统的软件初始化体中加入FUN_Timer_SetDelay(&Delay1,20);第2个参数为定时时间，即20*10ms=200ms
 * （3）、在项目系统的实时任务体中不断判断FUN_Timer_DetectDelay(&Delay1)是否等于0，如果相等则表示延时200ms完成
 */


/********************************************************************************************************************************************
*                                                                                                                                           *
*               ----------------------------------以下模块的对接函数区-----------------------------------------                             *
*                                                                                                                                           *
********************************************************************************************************************************************/

/********************************************************************************************************************************************
*                                                                                                                                           *
*               ----------------------------------以下是模块的内部函数申明区------------------------------------                            *
*                                                                                                                                           *
********************************************************************************************************************************************/


/********************************************************************************************************************************************
*                                                                                                                                           *
*               ----------------------------------以下是模块的变量申明和宏定义区--------------------------------                            *
*                                                                                                                                           *
********************************************************************************************************************************************/
static vu32 TimerCounter = 0;

/********************************************************************************************************************************************
*                                                                                                                                           *
*               ----------------------------------以下是模块的系统函数代码区------------------------------------                            *
*                                                                                                                                           *
********************************************************************************************************************************************/
/***************************************************************************
* 函 数 名: FUN_Timer_INT
* 功能描述：定时器中断函数
* 入口参数：无
* 出口参数：无
* 注意事项: 定时器中断的时间直接影响定时值
* 修改记录:
*           2021-10-18 BY:YJX
***************************************************************************/
void FUN_Timer_INT(void)
{     
     TimerCounter++;//计数器
}
/********************************************************************************************************************************************
*                                                                                                                                           *
*               ----------------------------------以下是模块的用户函数代码区------------------------------------                            *
*                                                                                                                                           *
********************************************************************************************************************************************/
/***************************************************************************
* 函 数 名:     FUN_Timer_SetDelay
* 功能描述：设置（开启）定时器
* 入口参数：TIMERTYPE *Systimer：（即定时器名称）的地址
*           vu32 delaynumber：所要定时的数值--当该参数设置为0时，表示关闭该函数
* 出口参数：
          小于0:表示启动定时器失败
          等于0:表示启动定时器成功
* 注意事项: 
           如果定时器每10ms中断调用一次FUN_Timer_INT函数
           则delaynumber设置的定时时间为delaynumber * 10ms
           如果定时器每1ms中断调用一次FUN_Timer_INT函数
           则delaynumber设置的定时时间为delaynumber * 1ms
           当然，需要调用FUN_Timer_DetectDelay函数来判断是否超时
* 修改记录:修改了对定时为0的值当作关闭定时器来使用
*           2021-10-18 BY:YJX
***************************************************************************/
s8 FUN_Timer_SetDelay(TIMERTYPE *Systimer,vu32 delaynumber)
{
     if(delaynumber <= 0)
     {
          Systimer->Enable = 0;//关闭定时器
          return -1;//启动失败
     }

     Systimer->Enable = 1;//开启定时器
     Systimer->PreSysBaseTime = TimerCounter;//记录当前系统基准时间
     Systimer->DelayTime = (delaynumber - 1);//保存定时时间  

     return 0;//启动成功
}
/***************************************************************************
* 函数名:     FUN_Timer_DetectDelay
* 功能描述：侦测定时器是否定时完成。
* 入口参数：   *Systimer：即定时器名称
* 出口参数：
          小于0:表示定时器未开启
          等于0:表示定时器定时完成
          大于0:表示定时器定时未完成
* 注意事项 :
* 修改记录 : 
*           2021-10-18 BY:YJX
***************************************************************************/
s8 FUN_Timer_DetectDelay(TIMERTYPE *Systimer)
{
     vu32 temp;
     
     if(Systimer->Enable == 0)
     {
          return -1;//定时器未启动
     }

     temp = ((TimerCounter) - (Systimer->PreSysBaseTime));
     if(temp > (Systimer->DelayTime))
     {
          Systimer->Enable = 0;//关闭定时器
          return 0;//定时器已完成定时
     }
     return 1;//定时器未完成定时
}
/***************************************************************************
* 函数名:     FUN_Timer_CloseDelay
* 功能描述：关闭定时器。
* 入口参数：   *Systimer：即定时器名称
* 出口参数：无
* 注意事项 : 
* 修改记录 : 
*           2021-10-18 BY:YJX
***************************************************************************/
void FUN_Timer_CloseDelay(TIMERTYPE *Systimer)
{
     Systimer->Enable = 0;
}

/********************************************************************************************************************************************
*                                                                                                                                           *
*               ----------------------------------以下是模块的内部函数代码区------------------------------------                            *
*                                                                                                                                           *
********************************************************************************************************************************************/





